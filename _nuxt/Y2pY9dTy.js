import{f as e,v as a,Q as t,I as s,x as o,bP as l,R as n,bQ as i,ak as r,c as u,K as c,o as d,F as m,b as p,B as b,H as y,J as g,a4 as f,G as v,i as w,w as x,d as k,C as h,t as B,bN as S,E as T,s as V,a as _,aE as F,U as N,bh as q,ad as A,a0 as C,a2 as I,bS as z,bT as E,bU as L,bV as $,bW as G,bX as U,bY as j,m as M,bZ as R}from"#entry";import{u as W}from"./5S8AQ56A.js";import{r as P,u as Q}from"./BUyr3k23.js";const O={key:1,class:"ml-5px"},D={class:"text-20px"},H={class:"min-h-60px py-10px"},J={class:"text-16px"},K={class:"flex mt-10px"},X={key:0,class:"ml-5px"},Y=e({__name:"quickSwap",props:{quickBuyValue:{},row:{},appendTo:{default:"#__nuxt"},buttonBg:{default:"rgba(18, 184, 134, 0.15)"},mainNameVisible:{type:Boolean},classNames:{default:""},size:{default:"14px"},buttonType:{default:0}},emits:["submitSwap","jump"],setup(e,{emit:Y}){const{walletSwap:Z,loadingWalletSwap:ee}=W(),{t:ae}=a(),te=e,se=t(),oe=s(!1),le=s(!1),ne=s(""),ie=o("noReminderQuickBuy",!1),re=Y;function ue(){if(re("submitSwap"),!A())return;if(oe.value)return;if(1===te.buttonType&&new C(te.quickBuyValue||0).lte(0))return void I({type:"error",plain:!0,message:ae("buyAmountMustG0"),duration:1e3});if(new C(te.quickBuyValue||0).lte(0))return void z({title:"Error",type:"error",message:ae("amountMustG0")});const{row:e}=te;ne.value=ae("quickBuyMsg",{a:te.quickBuyValue,m:S(te.row.chain)?.main_name||"",s:e.symbol||(e.target_token==e.token0_address?e.token0_symbol:e.token1_symbol)}),ie.value||1===te.buttonType?pe():le.value=!0}const ce=s(),de=l(),me=n();async function pe(){if(me.provider&&me.address&&!se.evmAddress)return void async function(){const e=new C(te.quickBuyValue||0).toFixed();Z(e,te.row)}();le.value=!1;const{chain:e}=te.row;oe.value=!0,await async function(e){const a=se.getWalletAddress(e);if(!a)return;const t=await R({chain:e,tokens:[$(e)],walletAddress:a}),s=t?.[0]||{};ce.value={...s,symbol:S(e)?.main_name,chain:e,address:s.token||s.address,decimals:s.decimals||s.decimal}}(e);const a=ce.value,t=new C(te.quickBuyValue||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${a?.decimals||18}})?`))?.[0];return(Number(t)||0)<=0?(z({title:"Error",type:"error",message:ae("amountTooSmall")}),void(oe.value=!1)):new C(t||0).gt(a?.balance||0)?(z({title:"Error",type:"error",message:ae("insufficientBalance")}),void(oe.value=!1)):void async function(e){const{chain:a}=te.row,t="solana"===a,{botSettings:s}=de,o=s?.[a]?.buy?.selected,l=s?.[a]?.buy?.[o];if(t&&l?.mev&&!(await se.getBundleAvailable()))return void(oe.value=!1);const{gasTip1List:n,gasTip2List:i}=E(L().gasTip,"solana"),r=l?.mev?n:i,u=l?.mev?l?.gas[0]:l?.gas?.[1];let c={};if(t){let e=u?.customFee||r?.[u?.level]||"0.002";l?.mev&&new C(e).lt("0.002")&&(e="0.002"),c.priorityFee=new C(e).times(10**9).toFixed(0)}else{const e=0===Number(u?.customFee)?"0":u?.customFee||r?.[u?.level]||"3";c.gasTip=Number(new C(e).times(10**9).toFixed(0)),c.contractType=0,c.chain=a}const d=$(a),m=l?.slippage||"9",p=se.getWalletAddress(a);if(!p)return;c={...c,batchId:Date.now().toString(),swapList:[{creatorAddress:p,inAmount:new C(e||0).times(10**ce.value.decimals||0).toFixed(0)}],inTokenAddress:d,outTokenAddress:te.row.token||te.row.target_token,swapType:1,isPrivate:l?.mev||!1,slippage:"auto"!==m?Number(new C(m).times(100).toFixed(0)):900,autoSell:de.autoSellConfig_autoSell||!1,autoSellConfig:de?.autoSellConfig,autoGas:u?.customFee?0:(u?.level||0)+1,autoSellGas:u?.customFee?0:(u?.level||0)+1,autoSellPriorityFee:t?c.priorityFee:c.gasTip};(t?G(c):U(c)).then(e=>function(e,a){if(e){let t=setTimeout(()=>{z({type:"success",message:ae("transactionsSubmitted")}),be.placeOrderUpdate++,oe.value=!1},500);const s=te.row.chain,o=e?.[0]||{};P({txInfo:o,chain:s,destination:"solana"===s?"/botapi/swap/createSolTx":"/botapi/swap/createSwapEvmTx",type:10});const l={[o?.batchId]:o?.id},n=M(()=>ye.wsResult.tgbot,e=>{const s=e.batchId;if(s===a){if(t&&(clearTimeout(t),t=null),be.placeOrderSuccess++,e?.txList?.[0]?.success){z({type:"success",message:ae("tradeSuccess")}),re("jump");const a=e?.txList?.[0];Q({...a,chain:e?.chain},l?.[s]||"")}else j(e?.txList?.[0]?.failMessage||"swap error");n(),oe.value=!1}})}}(e,c.batchId)).catch(e=>{j(e||"swap error"),oe.value=!1})}(t)}const be=i(),ye=r();return(a,t)=>{const s=h,o=y,l=F,n=T;return 0===e.buttonType?(d(),u(m,{key:0},[p(o,{disabled:!Number(e.quickBuyValue),loading:w(oe)||w(ee),color:e.buttonBg,class:v(["flex items-center [&&]:px-8px [&&]:py-5px [&&]:h-auto",e.classNames]),style:f([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":e.size}]),onClick:g(ue,["stop","prevent"])},{default:x(()=>[w(oe)||w(ee)?b("",!0):(d(),c(s,{key:0,style:f({"font-size":e.size}),class:"mr-4px",name:"mynaui:lightning-solid"},null,8,["style"])),k(" "+B(e.quickBuyValue||0)+" ",1),e.mainNameVisible?(d(),u("span",O,B(("getChainInfo"in a?a.getChainInfo:w(S))(e.row.chain)?.main_name||""),1)):b("",!0)]),_:1},8,["disabled","loading","color","class","style"]),w(le)?(d(),c(n,{key:0,modelValue:w(le),"onUpdate:modelValue":t[1]||(t[1]=e=>V(le)?le.value=e:null),title:a.$t("buy"),width:"400px","append-to":e.appendTo},{header:x(()=>[_("span",D,B(a.$t("buy")),1)]),footer:x(()=>[p(o,{type:"primary",class:"w-full",size:"large",onClick:g(pe,["stop"])},{default:x(()=>[k(B(a.$t("confirm1")),1)]),_:1})]),default:x(()=>[_("div",H,[_("div",J,B(w(ne)),1),_("div",K,[p(l,{modelValue:w(ie),"onUpdate:modelValue":t[0]||(t[0]=e=>V(ie)?ie.value=e:null),class:"[&&]:[--el-checkbox-text-color:--d-999-l-666]",label:a.$t("noAlert"),size:"large"},null,8,["modelValue","label"])])])]),_:1},8,["modelValue","title","append-to"])):b("",!0)],64)):(d(),c(o,{key:1,loading:w(oe)||w(ee),color:e.buttonBg,class:v(["flex items-center [&&]:px-4px",e.classNames]),style:f([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":e.size}]),onClick:g(ue,["stop","prevent"])},{default:x(()=>[N(p(s,{class:"mr-4px text-12px",name:"mynaui:lightning-solid"},null,512),[[q,!w(oe)]]),k(" "+B(Number(e.quickBuyValue)?e.quickBuyValue||0:a.$t("buy"))+" ",1),e.mainNameVisible&&Number(e.quickBuyValue)?(d(),u("span",X,B(("getChainInfo"in a?a.getChainInfo:w(S))(e.row.chain)?.main_name||""),1)):b("",!0)]),_:1},8,["loading","color","class","style"]))}}});export{Y as _};
