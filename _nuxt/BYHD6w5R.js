import{f as e,v as a,Q as t,I as s,x as o,R as l,bP as n,bQ as i,ak as r,c as u,o as c,F as d,b as m,K as p,B as b,H as g,a4 as y,G as v,i as f,w,bR as x,ao as h,ap as k,d as S,C as B,t as F,bN as T,E as _,s as V,a as A,aE as N,J as q,ad as C,a0 as I,bS as E,bT as L,bU as $,bV as R,bW as G,bX as P,bY as U,m as W,bZ as M}from"#entry";import{u as Q}from"./5S8AQ56A.js";import{r as j,u as z}from"./BUyr3k23.js";const O={key:1,class:"ml-5px"},D={class:"text-20px"},H={class:"min-h-60px py-10px"},J={class:"text-16px"},K={class:"flex mt-10px"},X=e({__name:"quickSwapButton",props:{quickBuyValue:{},row:{},appendTo:{default:"#__nuxt"},buttonBg:{default:"rgba(18, 184, 134, 0.15)"},mainNameVisible:{type:Boolean},classNames:{default:""},styles:{default:""}},emits:["submitSwap"],setup(e,{emit:X}){const{t:Y}=a(),Z=e,ee=t(),ae=s(!1),te=s(!1),se=s(""),oe=o("noReminderQuickBuy",!1),{walletSwap:le,loadingWalletSwap:ne}=Q(),ie=l(),re=X;function ue(e){if(e.stopPropagation(),re("submitSwap"),!C())return;if(ae.value)return;if(new I(Z.quickBuyValue||0).lte(0))return void E({title:"Error",type:"error",message:Y("amountMustG0")});const{row:a}=Z;se.value=Y("quickBuyMsg",{a:Z.quickBuyValue,m:T(Z.row.chain)?.main_name||"",s:a.symbol||(a.target_token==a.token0_address?a.token0_symbol:a.token1_symbol)}),oe.value?me():te.value=!0}const ce=s(),de=n();async function me(){if(te.value=!1,ie.provider&&ie.address&&!ee.evmAddress)return void async function(){const e=new I(Z.quickBuyValue||0).toFixed();le(e,Z.row)}();const{chain:e}=Z.row;ae.value=!0,await async function(e){const a=ee.getWalletAddress(e);if(!a)return;const t=await M({chain:e,tokens:[R(e)],walletAddress:a}),s=t?.[0]||{};ce.value={...s,symbol:T(e)?.main_name,chain:e,address:s.token||s.address,decimals:s.decimals||s.decimal}}(e);const a=ce.value,t=new I(Z.quickBuyValue||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${a?.decimals||18}})?`))?.[0];return(Number(t)||0)<=0?(E({title:"Error",type:"error",message:Y("amountTooSmall")}),void(ae.value=!1)):new I(t||0).gt(a?.balance||0)?(E({title:"Error",type:"error",message:Y("insufficientBalance")}),void(ae.value=!1)):void async function(e){const{chain:a}=Z.row,t="solana"===a,{botSettings:s}=de,o=s?.[a]?.buy?.selected,l=s?.[a]?.buy?.[o];if(t&&l?.mev&&!(await ee.getBundleAvailable()))return void(ae.value=!1);const{gasTip1List:n,gasTip2List:i}=L($().gasTip,"solana"),r=l?.mev?n:i,u=l?.mev?l?.gas[0]:l?.gas?.[1];let c={};if(t){let e=u?.customFee||r?.[u?.level]||"0.002";l?.mev&&new I(e).lt("0.002")&&(e="0.002"),c.priorityFee=new I(e).times(10**9).toFixed(0)}else{const e=0===Number(u?.customFee)?"0":u?.customFee||r?.[u?.level]||"3";c.gasTip=Number(new I(e).times(10**9).toFixed(0)),c.contractType=0,c.chain=a}const d=R(a),m=l?.slippage||"9",p=ee.getWalletAddress(a);if(!p)return;c={...c,batchId:Date.now().toString(),swapList:[{creatorAddress:p,inAmount:new I(e||0).times(10**ce.value.decimals||0).toFixed(0)}],inTokenAddress:d,outTokenAddress:Z.row.token||Z.row.target_token,swapType:1,isPrivate:l?.mev||!1,slippage:"auto"!==m?Number(new I(m).times(100).toFixed(0)):900,autoSell:de.autoSellConfig_autoSell||!1,autoSellConfig:de?.autoSellConfig,autoGas:u?.customFee?0:(u?.level||0)+1,autoSellGas:u?.customFee?0:(u?.level||0)+1,autoSellPriorityFee:t?c.priorityFee:c.gasTip};(t?G(c):P(c)).then(e=>function(e,a){if(e){let t=setTimeout(()=>{E({type:"success",message:Y("transactionsSubmitted")}),pe.placeOrderUpdate++,ae.value=!1},500);const s=Z?.row?.chain||"",o=e?.[0]||{};j({txInfo:o,chain:s,destination:"solana"===s?"/botapi/swap/createSolTx":"/botapi/swap/createSwapEvmTx",type:10});const l={[o?.batchId]:o?.id},n=W(()=>be.wsResult.tgbot,e=>{const s=e.batchId;if(s===a){if(t&&(clearTimeout(t),t=null),pe.placeOrderSuccess++,e?.txList?.[0]?.success){E({type:"success",message:Y("tradeSuccess")});const a=e?.txList?.[0];z({...a,chain:e?.chain},l?.[s]||"")}else U(e?.txList?.[0]?.failMessage||"swap error");n(),ae.value=!1}})}}(e,c.batchId)).catch(e=>{U(e||"swap error"),ae.value=!1})}(t)}const pe=i(),be=r();return(a,t)=>{const s=B,o=g,l=N,n=_;return c(),u(d,null,[m(o,{disabled:!Number(e.quickBuyValue),loading:f(ae)||f(ne),color:e.buttonBg,class:v(["flex items-center [&&]:px-12px",e.classNames]),style:y([{"--el-button-hover-bg-color":"#12B886","--el-button-hover-text-color":"#FFF","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},e.styles]),onClick:ue},{default:w(()=>[x(a.$slots,"default",h(k({loading:f(ae)||f(ne)})),()=>[f(ae)||f(ne)?b("",!0):(c(),p(s,{key:0,class:"mr-4px",name:"mynaui:lightning-solid"})),S(" "+F(e.quickBuyValue||0)+" ",1),e.mainNameVisible?(c(),u("span",O,F(("getChainInfo"in a?a.getChainInfo:f(T))(e.row.chain)?.main_name||""),1)):b("",!0)])]),_:3},8,["disabled","loading","color","class","style"]),f(te)?(c(),p(n,{key:0,modelValue:f(te),"onUpdate:modelValue":t[1]||(t[1]=e=>V(te)?te.value=e:null),title:a.$t("buy"),width:"400px","append-to":e.appendTo},{header:w(()=>[A("span",D,F(a.$t("buy")),1)]),footer:w(()=>[m(o,{type:"primary",class:"w-full",size:"large",onClick:q(me,["stop"])},{default:w(()=>[S(F(a.$t("confirm1")),1)]),_:1})]),default:w(()=>[A("div",H,[A("div",J,F(f(se)),1),A("div",K,[m(l,{modelValue:f(oe),"onUpdate:modelValue":t[0]||(t[0]=e=>V(oe)?oe.value=e:null),class:"[&&]:[--el-checkbox-text-color:--d-999-l-666]",label:a.$t("noAlert"),size:"large"},null,8,["modelValue","label"])])])]),_:1},8,["modelValue","title","append-to"])):b("",!0)],64)}}});export{X as _};
